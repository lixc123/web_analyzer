# 代理抓包故障排查指南

## 代理无法启动

### 问题：点击启动按钮后提示"端口被占用"

**原因：**
- 指定的端口已被其他程序占用
- 之前的代理进程未正常关闭

**解决方案：**
1. 更换端口号（推荐使用 8080-8090 范围）
2. 检查并关闭占用端口的程序：
   ```bash
   # Windows
   netstat -ano | findstr :8080
   taskkill /PID <进程ID> /F
   ```
3. 重启应用程序

### 问题：提示"权限不足"

**原因：**
- Windows 系统代理设置需要管理员权限
- 防火墙规则添加需要管理员权限

**解决方案：**
1. 以管理员身份运行应用程序
2. 或取消勾选"启用系统代理"选项

### 问题：启动后立即停止

**原因：**
- mitmproxy 依赖未正确安装
- 证书目录权限问题

**解决方案：**
1. 检查依赖安装：
   ```bash
   pip install mitmproxy>=10.0.0
   ```
2. 检查日志文件查看详细错误信息
3. 确保证书目录有读写权限

## HTTPS 请求无法捕获

### 问题：只能看到 CONNECT 请求，无法看到实际内容

**原因：**
- CA 证书未安装
- CA 证书未被信任

**解决方案：**

**Windows：**
1. 在"证书管理"标签点击"安装证书到 Windows"
2. 或手动安装证书到"受信任的根证书颁发机构"

**iOS：**
1. 确保已安装描述文件
2. 前往"设置 → 通用 → 关于本机 → 证书信任设置"
3. 启用对 mitmproxy 证书的完全信任

**Android：**
1. 确保证书已安装到"CA 证书"（不是"用户证书"）
2. Android 7.0+ 需要应用配置信任用户证书

### 问题：部分网站显示证书错误

**原因：**
- 网站使用了证书固定（Certificate Pinning）
- 证书未正确安装

**解决方案：**
1. 对于证书固定的应用，无法通过常规代理捕获
2. 确认其他 HTTPS 网站是否正常，排除证书安装问题

## 移动端无法连接

### 问题：移动设备配置代理后无法上网

**原因：**
- 代理服务未启动
- IP 地址或端口配置错误
- 防火墙阻止连接

**解决方案：**
1. 确认代理服务已启动（查看状态指示灯）
2. 检查移动端配置的 IP 和端口是否正确
3. Windows 防火墙设置：
   - 打开"Windows Defender 防火墙"
   - 点击"允许应用通过防火墙"
   - 确保 Python 或应用程序已允许专用和公用网络
4. 或临时关闭防火墙测试

### 问题：iOS 提示"无法连接到代理服务器"

**原因：**
- 设备不在同一网络
- 代理服务器地址错误

**解决方案：**
1. 确认 iOS 设备和电脑连接到同一个 WiFi
2. 在电脑上运行 `ipconfig`（Windows）查看正确的 IP 地址
3. 使用"移动端配置"标签中显示的 IP 地址

### 问题：Android 配置代理后部分应用无法联网

**原因：**
- 应用检测到代理并拒绝连接
- 应用使用了证书固定

**解决方案：**
1. 这是应用的安全机制，无法绕过
2. 尝试使用浏览器访问网站进行测试

## 证书安装失败

### 问题：Windows 证书安装提示"导入失败"

**原因：**
- 证书文件损坏
- 权限不足

**解决方案：**
1. 重新生成证书（停止代理后重启）
2. 以管理员身份运行应用
3. 手动安装：
   - 下载证书文件
   - 右键 → 安装证书
   - 选择"本地计算机"
   - 放入"受信任的根证书颁发机构"

### 问题：iOS 无法下载描述文件

**原因：**
- Safari 阻止了下载
- 网络连接问题

**解决方案：**
1. 在 Safari 设置中允许下载
2. 尝试使用二维码扫描方式
3. 确保代理服务正在运行

### 问题：Android 提示"无法安装证书"

**原因：**
- 未设置锁屏密码
- 证书格式不正确

**解决方案：**
1. 设置锁屏密码（PIN、图案或密码）
2. 确保下载的是 .cer 格式证书
3. 尝试重新下载证书

## 性能问题

### 问题：请求列表加载缓慢

**原因：**
- 捕获的请求过多
- 响应体过大

**解决方案：**
1. 使用过滤规则减少捕获的请求
2. 定期清理历史请求
3. 限制响应体大小（已默认限制为 10000 字符）

### 问题：代理响应延迟高

**原因：**
- 请求处理逻辑耗时
- 系统资源不足

**解决方案：**
1. 关闭不必要的过滤规则
2. 减少同时连接的设备数量
3. 检查系统资源使用情况

## 其他问题

### 问题：停止代理后系统仍无法上网

**原因：**
- 系统代理设置未恢复

**解决方案：**
1. 手动关闭系统代理：
   - Windows：设置 → 网络和 Internet → 代理 → 关闭"使用代理服务器"
2. 或重启网络连接

### 问题：请求列表中看不到某些请求

**原因：**
- 被过滤规则过滤
- 应用未使用系统代理

**解决方案：**
1. 检查过滤规则设置
2. 某些应用不遵循系统代理设置，无法捕获

### 问题：如何查看详细的错误日志

**解决方案：**
1. 查看应用日志文件（通常在 logs 目录）
2. 使用浏览器开发者工具查看前端错误
3. 检查后端控制台输出

## 联系支持

如果以上方案无法解决问题，请：
1. 收集错误日志
2. 记录复现步骤
3. 提交问题报告
